# Batchfuscation - CTF Challenge Writeup

## Challenge Information
- **Name**: Batchfuscation
- **Points**: 50
- **Category**: Malware

## Objective
The objective of the "Batchfuscation" CTF challenge is to deobfuscate and make sense of a highly obfuscated batch script. This script contains various obfuscation techniques, and your task is to reveal the hidden flag by unraveling its complexity.

## Solution
Solving the "Batchfuscation" challenge involves unraveling a series of batch script obfuscation techniques to reveal the hidden flag. Here's a step-by-step guide on how to tackle this complex task:

1. **Examine the Batch Script**: Upon opening the provided file, you will encounter a batch script that appears to be meticulously obfuscated. Your first impression might be that it is tedious and challenging to make sense of.

2. **Identify Obfuscated Variables**: Begin by identifying obfuscated variables and their values. For example, the line `set bdevq=set` is setting the variable `bdevq` to the value `set`. Similarly, `%bdevq% grfxdh= ` evaluates to `set grfxdh= `, essentially setting the variable `grfxdh` to an `empty string`.

3. **Deobfuscate Gradually**: Proceed to deobfuscate the script gradually by identifying and interpreting each obfuscated line. Your goal is to transform these lines into their readable and meaningful counterparts. In the process, you'll uncover the true functionality of the batch script.

4. **Identify Flag Components**: As you deobfuscate the script, you will discover that certain lines spell out `flag_character`. There are a total of 38 instances of these lines, matching the number of characters typically found for flags in Huntress CTF.
![Flag Hint](<flag hint.png>)

5. **Extract Flag Components with Python**: To extract the flag components efficiently, use Python scripting to locate and organize all instances of `flag_character`. This step will help you obtain the individual characters that make up the flag.

6. **Order and Assemble the Flag**: Once you have extracted all the flag components, arrange them in the proper order to form the complete flag for the CTF challenge.
    ```python
    dictionary = {}

    with open("deobfuscated.txt", "r") as file: 
      content = file.readlines()
      for line in content: 
        line = line[:-1]
        if "flag_character" in line:
          flag_position = line.split(" ")[-1].split("=")[0][14:]
          flag_char = line.split(" ")[-1].split("=")[1]

          dictionary[flag_position] = flag_char

    flag = ""

    sorted_data = dict(sorted([(int(key), value) for key, value in dictionary.items()]))

    for key, value in sorted_data.items():
        flag += value

    print(flag)
    ```

By following these steps and patiently deobfuscating the batch script, you can successfully reveal and assemble the hidden flag.

## Flag
The flag is in the format `flag{XXXXXXXXXX}`. After carefully deobfuscating the batch script and extracting the flag components, you should be able to assemble the complete flag.
